@page "/stageone"
@using Best_Hackathon_Codiseea.Models;
@using Best_Hackathon_Codiseea.Data;
@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor httpContextAccessor
@inject TeamTaskService teamTaskService
@*@inject AnswerService answerService*@
@attribute [Authorize]
<h3>Bun venit la BEST Hackathon Codiseea !</h3>
<h6>
    Ne bucurăm că sunteţi alături de noi, pentru a începe cel mai fain drum, dar şi cel mai dificil.
    La această etapă trebuie să vă adaptaţi, pentru a înfrunta alternativul creaturilor mitice, adică problemele logice.
</h6>
<h6>
    Alte detalii:
    Soluţiile se vor introduce în chenarele de mai jos, iar după ce aţi introdus soluţia, butonaţi "Submit".
</h6>

<br />
<br />
@if (teamTasks2 == null || teamTasks3 == null || teamTasks4 == null || teamTasks5 == null || globalCorrectAnswers == null || personalCorrectAnswers == null)
{
    <p><em>Loading..</em></p>
}
else
{
<div class="container-fluid">
    <h2>Progresul personal</h2>
    <div class="progress">
        <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="@personalProgressWhoutPrecent" aria-valuemin="0" aria-valuemax="100" style="width:@PersonalProgress()">
            @PersonalProgress()
        </div>
    </div>
    <br />
    <hr />
    <br />
    <div class="card">
        <div class="card-body">
            <h4>
                1. Status : <span class="text-success">@StatusAnswer(teamTasks1)</span>
            </h4>
            <hr />
            <div hidden="@HideAnswer(teamTasks1)">
                <strong>Problema:</strong>
                <p>BEST Chișinău iubește culoarea roșu.</p>
                <br />
                <strong>Sarcina:</strong>
                <br />
                <p>Trebuie să calculați suma componentelor roșii din fiecare pixel a <a href="https://drive.google.com/u/0/uc?id=1HPxGU2uXfbxHAyRan4cHtHuOaS8EKNWq&export=download">imaginii</a></p>
                <br />
                <div class="row">
                    <div class="col-9">
                        <input class="form-control" @bind="@UserAnswer">
                    </div>
                    <div class="col-3">
                        <button type="submit" class="btn btn-primary" @onclick="() => CheckAnswer(1)">Submit</button>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <br />
    <div class="card">
        <div class="card-body">
            <h4>
                2. Status : <span class="text-success">@StatusAnswer(teamTasks2)</span>
            </h4>
            <hr />
            <div hidden="@HideAnswer(teamTasks2)">
                <strong>Problema succesului:</strong>
                <p>
                    Se dă un şir de numere care ar reprezenta succesul unei persoane. Succesul este atunci când valorile din subşir sunt în ordine crescătoare. Pentru că nimeni nu este ideal, după fiecare acţiune executată cu succes, urmează insuccesul - o valoare mai mică de cât precedenta.
                    Toate acestea se vor repeta una după alta până când se va întâlni valoarea 0, rezultând sfarşitul şirului.
                </p>
                <br />
                <strong>Sarcina:</strong>
                <p>Se va afişa succesul în ordine inversă celei de introducer, separate prin spaţiu.</p>
                <strong>Exemplu:</strong>
                <p>Intrare: 1 2 10 3 7 5 4 3 0</p>
                <p>Ieşire:  10 2 1 7 3 3 4 5 2</p>
                <br />
                <p>Numerele 1,2,10 reprezintă succesul, respectiv ca date de ieşire se vor inversa (10,2,1), dupa urmează nr 3 şi reprezintă eşecul, iar 7 reprezintă succesul, iar 5,4,3 reprezintă eşecul. La sfarşitul şirului de numere, în locul lui 0 va fi numărul de succese, în cazul nostru este nr 2.</p>
                <br />
                <p>Datele de intrare pentru determinarea cheii: 1 1 4 8 9 2 4 8 44 5 86 2 4 0</p>
                <br />
                <div class="row">
                    <div class="col-9">
                        <input class="form-control" @bind="@UserAnswer2">
                    </div>
                    <div class="col-3">
                        <button type="submit" class="btn btn-primary" @onclick="() => CheckAnswer(2)">Submit</button>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <br />
    <div class="card">
        <div class="card-body">
            <h4>
                3. Status : <span class="text-success">@StatusAnswer(teamTasks3)</span>
            </h4>
            <hr />
            <div hidden="@HideAnswer(teamTasks3)">
                <strong>Problema:</strong>
                <p>Sunt date <a href="https://drive.google.com/u/0/uc?id=13Uuo0yslwXKzi1b0bL3SzIdJRE5OznKq&export=download">două fișiere</a> care conțin cuvinte. Primul fișier conține mai multe cuvinte. Al doilea conține câteva din cuvintele din primul fișier dar literele sunt schimbare cu locul în interiorul cuvintelor.</p>
                <br />
                <strong>Sarcina:</strong>
                <p>
                    Să se găsească cuvintele care se conțin în ambele șiruri. <br />
                    Cheia va conține cuvintele concatenate în ordinea din fișierul al doilea.
                </p>
                <br />
                <div class="row">
                    <div class="col-9">
                        <input class="form-control" @bind="@UserAnswer3">
                    </div>
                    <div class="col-3">
                        <button type="submit" class="btn btn-primary" @onclick="() => CheckAnswer(3)">Submit</button>
                    </div>
                </div>

        </div>
    </div>
</div>
<br />

    <div class="card">
        <div class="card-body">
            <h4>
                4. Status : <span class="text-success">@StatusAnswer(teamTasks4)</span>
            </h4>
            <hr />
            <div hidden="@HideAnswer(teamTasks4)">
                <strong>Problema:</strong>
                <p>Pe pagina <a href="https://www.instagram.com/best_chisinau/">BEST Chişinău</a> de instagram sunt ascunse bucăți de cheie.</p>
                <br />
                <strong>Sarcina:</strong>
                <br />
                <p>Găsiți cheia.</p>
                <br />
                <div class="row">
                    <div class="col-9">
                        <input class="form-control" @bind="@UserAnswer4">
                    </div>
                    <div class="col-3">
                        <button type="submit" class="btn btn-primary" @onclick="() => CheckAnswer(4)">Submit</button>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <br />
    <div class="card">
        <div class="card-body">
            <h4>
                5. Status : <span class="text-success">@StatusAnswer(teamTasks5)</span>
            </h4>
            <hr />
            <div hidden="@HideAnswer(teamTasks5)">
                <strong>Problema:</strong>
                <p>
                    În orașul Piticot locuiesc N pitici, fiecare într-o casă pe o stradă cu sens unic. Casele sunt așezate de-a lungul străzii, în sensul în care se circulă începând cu casa numerotată cu 1 până la casa numerotată cu N. În orașul Piticot piticii nu au un nume obișnuit! Ei poartă ca nume numărul casei în care stau. Neobișnuite sunt și casele lor! Dacă suni la soneria oricărei case depui atâta efort încât slăbești pe loc un număr de pitic-kilograme.
                    Pentru că au constatat că în timpul pandemiei s-au îngrășat, fiecare și-a propus să slăbească un număr de pitic-kilograme, într-o singură zi. Pentru asta fiecare pitic va alerga pe stradă, plecând din propria casă și respectând sensul de deplasare al străzii iar în timpul alergării va suna la fiecare casă întâlnită, inclusiv la propria casă, o singură dată la fiecare. Ca regulă, suplimentară ei se vor opri din alergare în următoarele situații:
                </p>
                <p>
                    1. Orice pitic se va opri la prima casă la care, după ce a sunat, a constatat că a slăbit de când a pornit alergarea, cel puțin cât și-a propus; <br />
                    2. Orice pitic se va opri din alergare dacă a sunat la ultima casă (casa N), chiar dacă nu a reușit să slăbească cât și-a propus.
                </p>
                <br />
                <strong>Sarcina:</strong>
                <p>Să se afle care este numărul maxim de pitici  care au sunat la o casă și la câte case s-a sunat de acest număr maxim de ori.</p>
                <strong>Date de intrare</strong>
                <p>Conține pe prima linie numărul natural N. Pe a doua linie se găsesc N numere naturale A[i], reprezentând numărul de pitic-kilograme cu care orice pitic slăbește dacă sună la casa cu numărul i (1 ≤ i ≤ N). A treia linie conține N numere naturale B[i], reprezentând numărul de pitic-kilograme pe care piticul i dorește să îl slăbească. În cadrul unei linii datele sunt separate prin câte un spațiu.</p>
                <strong>Exemplu:</strong>
                <p>
                    Intrare:
                    7 <br />
                    1 2 4 5 6 6 6 <br />
                    4 2 8 10 14 6 17 <br />
                </p>
                <p>
                    Ieşire:<br />
                    Fiind Max și Nr, separate prin-un spațiu, care reprezintă numărul maxim de pitici care au sunat la o casă, respectiv la câte case s-a sunat de număr maxim de ori.
                </p>
                <br />
                <p>Exemplu: Piticul 1 ca să slăbeasca cel puțin 4 pitic-kilograme sună la casele 1, 2 și 3. Piticul 2 sună doar la casa 2. Piticul 3 sună la casele 3 și 4. Piticul 4 sună la casele 4 și 5. Piticul 5 sună la casele 5, 6 și 7. Piticul 6 sună la casa 6 iar piticul 7 sună doar la casa 7 și nu reușește să slăbească cât și-a propus. Se observă că la casele 2, 3, 4, 5, 6, 7, s-a sunat de 2 ori, care este și numărul maxim de ori.</p>
                <br />
                <p>Sarcina respectiva se va verifica manual de catre organizatori</p>
                <br />
                <br />
                <div class="row">
                    <div class="col-9">
                        <textarea class="form-control" @bind="@UserAnswer5" style="width:36rem;"></textarea>
                    </div>
                    <div class="col-3">
                        <button type="submit" class="btn btn-primary" @onclick="() => CheckAnswer(5)">Submit</button>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <br />
    <br />
</div>
}

@code {
    public string CorrectAnswer { get; set; } = "59008105";

    public string CorrectAnswer2 { get; set; } = "9 8 4 1 1 44 8 4 2 86 5 4 2 4";

    public string CorrectAnswer3 { get; set; } = "lopatavremeasosindfrumosrotundurechinimenigleznecatargvislas";

    public string CorrectAnswer4 { get; set; } = "OGPTRUTSFVUJSPZPOCGGHTYNXYUTEDMXVZAETZEMWTCKIFUPCVNBPCPYLNQLSABMOGLSRCNXLKNKFSZNNRGUTFSPRINEBYYSJROBDJAQXDZUYKUEGMERFUHHXDFDQHRBLXTFMNOQPGKUCNXTHWESFMKMIWXZEWOOKSPJTWATRKHHUQSFZHVRLOAMPNHDRVAQPORHQQCQHWLDAVJSAURWFRNNISWDDJMZPGTMPRRZKIPRZGTDZBERCYTOLHPRWCVWQGDMIPWLQILCCQEWCUWRMQDLXPOOIVEVYOYDKTVRM";

    public string CorrectAnswer5 { get; set; } = "2 6";

    public string UserAnswer { get; set; }
    public string UserAnswer2 { get; set; }
    public string UserAnswer3 { get; set; }
    public string UserAnswer4 { get; set; }
    public string UserAnswer5 { get; set; }

    //date;

    List<TeamTask> teamTasks1;
    List<TeamTask> teamTasks2;
    List<TeamTask> teamTasks3;
    List<TeamTask> teamTasks4;
    List<TeamTask> teamTasks5;

    List<TeamTask> globalCorrectAnswers;
    List<TeamTask> personalCorrectAnswers;

    //List<Answer> Answers;

    protected override async Task OnInitializedAsync()
    {
        await load();
    }

    protected async Task load()
    {
        var teamName = httpContextAccessor.HttpContext.User.Identity.Name;

        teamTasks1 = await teamTaskService?.GetTasksAsync(teamName, "1");
        teamTasks2 = await teamTaskService?.GetTasksAsync(teamName, "2");
        teamTasks3 = await teamTaskService?.GetTasksAsync(teamName, "3");
        teamTasks4 = await teamTaskService?.GetTasksAsync(teamName, "4");
        teamTasks5 = await teamTaskService?.GetTasksAsync(teamName, "5");

        globalCorrectAnswers = await teamTaskService.GetGlobalCorrectAnswersAsync();
        personalCorrectAnswers = await teamTaskService.GetPersonalTasksAsync(teamName);

        //Answers = await teamTaskService?.GetAnswersAsync();
    }
    public double personalProgressWhoutPrecent;
    public string PersonalProgress()
    {
        int TotalTasks = 5;
        double result = ((personalCorrectAnswers.Count * 100) / TotalTasks);
        personalProgressWhoutPrecent = result;
        return Convert.ToString(((personalCorrectAnswers.Count*100)/TotalTasks)+"%");
    }

    protected string StatusAnswer(List<TeamTask> Task)
    {
        string result = null;

        foreach (var item in Task)
        {
            result = (item.Value == "Correct") ? item.Value : "Incorrect";
        }
        return result;
    }

    protected bool HideAnswer(List<TeamTask> Task)
    {
        bool result = false;

        foreach (var item in Task)
        {
            result = (item.Value == "Correct") ? true : false;
        }
        return result;
    }

    protected async Task CheckAnswer(int VerifyTask)
    {
        switch (VerifyTask)
        {
            case 1:
                if (!string.IsNullOrEmpty(UserAnswer))
                {
                    if (UserAnswer.ToLower() == CorrectAnswer.ToLower())
                    {
                        TeamTask s = new TeamTask()
                        {
                            ID = Guid.NewGuid().ToString(),
                            TeamName = httpContextAccessor.HttpContext.User.Identity.Name,
                            Value = "Correct",
                            Points = 1,
                            ItemNumber = "1",
                            Attempts = 0,
                            Date = DateTime.Now,
                        };

                        await teamTaskService.InsertTeamTaskAsync(s);
                        await load();
                    }
                    else
                    {
                        //value = "Incorrect";
                    }
                }
                break;
            case 2:
                if (!string.IsNullOrEmpty(UserAnswer2))
                {
                    if (UserAnswer2.ToLower() == CorrectAnswer2.ToLower())
                    {
                        TeamTask s = new TeamTask()
                        {
                            ID = Guid.NewGuid().ToString(),
                            TeamName = httpContextAccessor.HttpContext.User.Identity.Name,
                            Value = "Correct",
                            Points = 3,
                            ItemNumber = "2",
                            Date = DateTime.Now,
                        };

                        await teamTaskService.InsertTeamTaskAsync(s);
                        await load();
                    }
                    else
                    {
                        //value2 = "Incorrect";
                    }
                }
                break;
            case 3:
                if (!string.IsNullOrEmpty(UserAnswer3))
                {
                    if (UserAnswer3.ToLower() == CorrectAnswer3.ToLower())
                    {
                        TeamTask s = new TeamTask()
                        {
                            ID = Guid.NewGuid().ToString(),
                            TeamName = httpContextAccessor.HttpContext.User.Identity.Name,
                            Value = "Correct",
                            Points = 5,
                            ItemNumber = "3",
                            Date = DateTime.Now,
                        };

                        await teamTaskService.InsertTeamTaskAsync(s);
                        await load();
                    }
                    else
                    {
                        //value3 = "Incorrect";
                    }
                }
                break;
            case 4:
                if (!string.IsNullOrEmpty(UserAnswer4))
                {
                    if (UserAnswer4.ToLower() == CorrectAnswer4.ToLower())
                    {
                        TeamTask s = new TeamTask()
                        {
                            ID = Guid.NewGuid().ToString(),
                            TeamName = httpContextAccessor.HttpContext.User.Identity.Name,
                            Value = "Correct",
                            Points = 7,
                            ItemNumber = "4",
                            Date = DateTime.Now,
                        };

                        await teamTaskService.InsertTeamTaskAsync(s);
                        await load();
                    }
                    else
                    {
                        //value4 = "Incorrect";
                    }
                }
                break;
            case 5:
                if (!string.IsNullOrEmpty(UserAnswer5))
                {
                    if (UserAnswer5.Contains(CorrectAnswer5))
                    {
                        TeamTask s = new TeamTask()
                        {
                            ID = Guid.NewGuid().ToString(),
                            TeamName = httpContextAccessor.HttpContext.User.Identity.Name,
                            Value = "Correct",
                            Points = 9,
                            ItemNumber = "5",
                            Date = DateTime.Now,
                        };

                        await teamTaskService.InsertTeamTaskAsync(s);
                        await load();
                    }
                    else
                    {
                        //value5 = "Incorrect";
                    }
                }
                break;
            default:
                //value = "Answers not found";
                break;
        }
    }
}
